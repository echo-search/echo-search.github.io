<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Browser Achievements — Single File</title>
<style>
  :root{
    --bg:#0f1720; --card:#0b1220; --muted:#9aa4b2; --accent:#7ad7f0; --good:#8be78b;
  }
  body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial; background:linear-gradient(180deg,#071021 0%, #071827 60%); color:#e6eef6; margin:0; padding:24px;}
  header{display:flex;align-items:center;gap:12px;margin-bottom:18px;}
  h1{margin:0;font-size:20px;}
  p.lead{margin:0;color:var(--muted);font-size:13px;}
  .container{display:grid;grid-template-columns:320px 1fr;gap:18px;}
  .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(3,8,15,0.6);border:1px solid rgba(255,255,255,0.03);}
  .badges{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:10px;}
  .badge{padding:10px;border-radius:10px;background:rgba(255,255,255,0.02);display:flex;align-items:center;gap:10px;border:1px solid rgba(255,255,255,0.02);}
  .badge.locked{opacity:0.45;filter:grayscale(20%);}
  .badge .ico{width:36px;height:36px;border-radius:8px;background:linear-gradient(135deg,var(--card),#071122);display:flex;align-items:center;justify-content:center;font-weight:700;color:var(--accent);}
  .badge .title{font-size:13px;margin:0;}
  .badge .meta{font-size:11px;color:var(--muted);}
  .controls{display:flex;gap:8px;margin-bottom:12px;}
  button, .btn{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--accent);padding:8px 10px;border-radius:8px;cursor:pointer;}
  .btn.primary{background:var(--accent);color:#04121a;border:none;}
  .log{height:220px;overflow:auto;padding:10px;border-radius:10px;background:#02060a;border:1px solid rgba(255,255,255,0.02);font-family:monospace;font-size:12px;color:var(--muted);}
  .toast{position:fixed;right:18px;bottom:24px;background:linear-gradient(90deg,#06202a,#0b1a22);padding:12px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 10px 30px rgba(2,6,10,0.6);display:flex;gap:10px;align-items:center;}
  .small{font-size:12px;color:var(--muted)}
  .dot{width:10px;height:10px;border-radius:50%;background:var(--good);display:inline-block}
  /* hidden tiny target for 'Precise Clicker' */
  #tiny-target{position:fixed;left:6px;top:6px;width:14px;height:14px;border-radius:3px;background:transparent;border:2px dashed rgba(255,255,255,0.03);cursor:pointer;z-index:9999;}
  /* secret hover area */
  #secret-hover{position:fixed;right:6px;bottom:6px;width:56px;height:56px;border-radius:10px;background:transparent;z-index:9999;}
  footer{margin-top:14px;color:var(--muted);font-size:12px;}
  .achieved{border-left:4px solid var(--good);padding-left:8px;}
</style>
</head>
<body>
<header>
  <div style="width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#5ed0e6);display:flex;align-items:center;justify-content:center;font-weight:700;color:#021216">A</div>
  <div>
    <h1>Browser Achievements (Single File)</h1>
    <p class="lead">Real, verifiable browser events only — saved locally.</p>
  </div>
</header>

<div class="container">
  <div class="panel">
    <div class="controls">
      <button id="resetBtn" class="btn">Reset Achievements</button>
      <button id="exportBtn" class="btn">Export JSON</button>
      <button id="importBtn" class="btn">Import JSON</button>
    </div>

    <h3 style="margin-top:6px">Achievements</h3>
    <div id="badges" class="badges" aria-live="polite"></div>

    <div style="margin-top:12px">
      <h4 style="margin:6px 0 8px 0">Activity Log</h4>
      <div id="log" class="log" role="log" aria-live="polite"></div>
    </div>
  </div>

  <div class="panel" id="infoPanel">
    <h3>How this works</h3>
    <p class="small">The page listens for genuine browser events — scroll, key presses, copy/paste, visibility changes, mouse movement, fullscreen, resize, touches, and more. Achievements are stored in <code>localStorage</code>. Nothing is sent anywhere.</p>

    <hr style="opacity:0.05;margin:12px 0">

    <div>
      <h4 style="margin:0 0 8px 0">Current Progress</h4>
      <div id="progress" class="small">Loading…</div>
    </div>

    <hr style="opacity:0.05;margin:12px 0">

    <div>
      <h4 style="margin:0 0 8px 0">Quick Tips</h4>
      <ul class="small" style="margin:0 0 12px 18px">
        <li>Scroll, click the tiny square top-left, copy some text, try backspace rapidly, or open DevTools to see achievements unlock.</li>
        <li>Export to save between devices (download the JSON); import will restore.</li>
      </ul>
      <button id="showHidden" class="btn">Show Hidden Targets</button>
    </div>
  </div>
</div>

<!-- tiny interactive elements -->
<div id="tiny-target" title="Tiny target"></div>
<div id="secret-hover" title="Secret hover area"></div>

<!-- toast container -->
<div id="toasts" aria-live="polite" style="position:fixed;right:18px;bottom:24px;pointer-events:none"></div>

<footer>
  <div class="small">Local-only achievements • Single-file system • No AI involved.</div>
</footer>

<script>
/*
 Single-file achievement system.
 - Achievements are real events and recorded in localStorage.
 - Achievements schema: {id, name, desc, unlocked:bool, ts}
*/

const ACH_KEY = 'browser_achievements_v1';
const logEl = document.getElementById('log');
const badgesEl = document.getElementById('badges');
const progressEl = document.getElementById('progress');
const toasts = document.getElementById('toasts');

function nowISO(){ return new Date().toISOString(); }
function log(msg){ const ln = '['+new Date().toLocaleTimeString()+'] '+msg; logEl.innerText = ln + '\n' + logEl.innerText; }
function toast(msg){
  const el = document.createElement('div');
  el.className = 'toast';
  el.style.pointerEvents='auto';
  el.innerHTML = '<div style="font-weight:700;color:var(--accent);margin-right:8px">Badge</div><div><div style="font-size:13px">'+msg+'</div></div>';
  toasts.appendChild(el);
  setTimeout(()=>{ el.style.transition='opacity .4s'; el.style.opacity='0'; setTimeout(()=>el.remove(),400); }, 2400);
}

// Definition of achievements
const ACHIEVEMENTS = [
  { id:'first_scroll', name:'First Scroll', desc:'Scroll at least 1px.' },
  { id:'top_of_world', name:'Top of the World', desc:'Scroll back to the very top.' },
  { id:'bottom_dweller', name:'Bottom Dweller', desc:'Scroll to the very bottom.' },
  { id:'idle_30s', name:'Idle for 30s', desc:'No mouse/keyboard/touch for 30 seconds.' },
  { id:'loyal_2min', name:'Loyal Viewer — 2 minutes', desc:'Stay on page for 2 minutes.' },
  { id:'back_again', name:'Back Again?', desc:'Switch away and return to the tab.' },
  { id:'speed_demon', name:'Speed Demon', desc:'Very fast scrolling detected.' },
  { id:'precise_clicker', name:'Precise Clicker', desc:'Click the tiny top-left target.' },
  { id:'secret_hover', name:'Secret Hover', desc:'Hover a secret area for 3 seconds.' },
  { id:'devtools_snitch', name:'Developer Mode', desc:'DevTools (likely) opened.' },
  { id:'backspace_warrior', name:'Backspace Warrior', desc:'Press Backspace 20 times.' },
  { id:'keyboard_pianist', name:'Keyboard Pianist', desc:'Press 50 keys.' },
  { id:'mouse_marathon', name:'Mouse Marathon', desc:'Move the mouse a total of 1000px.' },
  { id:'triple_click', name:'Triple Click Frenzy', desc:'Click 3 times in under 1 second.' },
  { id:'refresh_addict', name:'Refresh Addict', desc:'You reloaded the page (detected on load).' },
  { id:'touchscreen_ninja', name:'Touchscreen Ninja', desc:'Perform a swipe (mobile).' },
  { id:'resize_master', name:'Window Resize Master', desc:'Manually resize the browser window.' },
  { id:'fullscreen_convert', name:'Full-Screen Convert', desc:'Enter fullscreen.' },
  { id:'copycat', name:'Copycat', desc:'Copy any text on the page.' },
  { id:'forbidden_paste', name:'The Forbidden Paste', desc:'Paste something into the page.' }
];

let state = {ach:{}, stats:{}, created:nowISO()};
function initState(){
  const raw = localStorage.getItem(ACH_KEY);
  if(raw){
    try{
      state = JSON.parse(raw);
      // ensure schema
      if(!state.ach) state.ach = {};
    }catch(e){
      console.error('bad state JSON, resetting', e);
      state = {ach:{}, stats:{}, created:nowISO()};
    }
  }
  // ensure all achievements exist
  for(const a of ACHIEVEMENTS) if(!state.ach[a.id]) state.ach[a.id] = { ...a, unlocked:false, ts:null };
  persist();
}
function persist(){ localStorage.setItem(ACH_KEY, JSON.stringify(state)); renderBadges(); renderProgress(); }

function unlock(id){
  const item = state.ach[id];
  if(!item) return;
  if(item.unlocked) return;
  item.unlocked = true;
  item.ts = nowISO();
  persist();
  log('Unlocked: '+item.name);
  toast('Unlocked: '+item.name);
  renderBadges();
}

function renderBadges(){
  badgesEl.innerHTML = '';
  for(const a of Object.values(state.ach)){
    const div = document.createElement('div');
    div.className = 'badge '+(a.unlocked ? 'achieved' : 'locked');
    div.innerHTML = `<div class="ico">${a.unlocked ? '✓' : '·'}</div>
      <div style="flex:1"><div class="title">${a.name}</div><div class="meta">${a.unlocked ? 'Unlocked: '+new Date(a.ts).toLocaleString() : a.desc}</div></div>`;
    badgesEl.appendChild(div);
  }
}

function renderProgress(){
  const total = Object.keys(state.ach).length;
  const done = Object.values(state.ach).filter(x=>x.unlocked).length;
  progressEl.innerText = `${done} / ${total} achievements unlocked`;
}

/* ========== Event tracking plumbing ========== */

initState();

// LOG initial state
log('System started — achievements loaded.');
renderBadges();

// Activity tracking helpers
let lastActivity = Date.now();
function touchActivity(){ lastActivity = Date.now(); }

// Idle 30s
let idleTimer = null;
function resetIdle(){
  if(idleTimer) clearTimeout(idleTimer);
  idleTimer = setTimeout(()=>{ unlock('idle_30s'); }, 30000);
}

// Loyalty 2 minutes
setTimeout(()=>{ unlock('loyal_2min'); }, 2*60*1000);

// visibility change (back again)
document.addEventListener('visibilitychange', ()=>{
  touchActivity();
  if(document.visibilityState === 'visible') {
    unlock('back_again');
    log('Visibility: visible');
  } else {
    log('Visibility: hidden');
  }
});

// SCROLL events: first_scroll, top_of_world, bottom_dweller, speed_demon
let lastScroll = {t:Date.now(), y:window.scrollY};
let lastPositions = [];
window.addEventListener('scroll', e=>{
  touchActivity();
  resetIdle();
  const y = window.scrollY;
  if(!state.ach.first_scroll.unlocked) unlock('first_scroll');
  if(y === 0) unlock('top_of_world');
  if((window.innerHeight + window.scrollY) >= (document.body.scrollHeight - 2)) unlock('bottom_dweller');

  // velocity calc
  const t = Date.now();
  const dy = Math.abs(y - lastScroll.y);
  const dt = Math.max(1, t - lastScroll.t);
  const vel = dy / dt; // px per ms
  lastScroll = {t,y};
  lastPositions.push({t, vel});
  // keep last 6 entries
  if(lastPositions.length > 6) lastPositions.shift();
  const avgVel = lastPositions.reduce((s,i)=>s+i.vel,0)/lastPositions.length;
  if(avgVel > 1.5) { // threshold: ~1500px/s average
    unlock('speed_demon');
  }
});

// Precise clicker: top-left tiny target
const tiny = document.getElementById('tiny-target');
tiny.addEventListener('click', ()=>{
  touchActivity();
  unlock('precise_clicker');
  log('Tiny target clicked.');
});

// Secret hover area for 3s
const secret = document.getElementById('secret-hover');
let hoverTimer = null;
secret.addEventListener('mouseenter', ()=>{
  touchActivity();
  hoverTimer = setTimeout(()=>{ unlock('secret_hover'); }, 3000);
});
secret.addEventListener('mouseleave', ()=>{
  if(hoverTimer) { clearTimeout(hoverTimer); hoverTimer = null; }
});

// Detect devtools: heuristic using outer vs inner size
let devtoolsOpened = false;
function checkDevTools(){
  const threshold = 160; // px difference heuristic
  if(Math.abs(window.outerWidth - window.innerWidth) > threshold || Math.abs(window.outerHeight - window.innerHeight) > threshold){
    if(!devtoolsOpened){ devtoolsOpened = true; unlock('devtools_snitch'); log('DevTools heuristic: likely opened.'); }
  }
}
window.addEventListener('resize', ()=>{ checkDevTools(); touchActivity(); resetIdle(); unlock('resize_master'); });

// Keyboard stats: backspace warrior, pianist
let keyCount = 0;
let backspaceCount = 0;
document.addEventListener('keydown', (e)=>{
  touchActivity();
  resetIdle();
  keyCount++;
  if(keyCount >= 50) unlock('keyboard_pianist');
  if(e.key === 'Backspace') {
    backspaceCount++;
    if(backspaceCount >= 20) unlock('backspace_warrior');
  }
});

// Mouse movement distance (mouse marathon)
let lastMouse = null;
let mouseDistance = 0;
document.addEventListener('mousemove', (e)=>{
  touchActivity();
  resetIdle();
  if(lastMouse) {
    const dx = e.clientX - lastMouse.x;
    const dy = e.clientY - lastMouse.y;
    mouseDistance += Math.hypot(dx,dy);
    if(mouseDistance >= 1000) unlock('mouse_marathon');
  }
  lastMouse = {x:e.clientX, y:e.clientY};
});

// Triple click frenzy
let clickTimes = [];
document.addEventListener('click', ()=>{
  touchActivity();
  resetIdle();
  const t = Date.now();
  clickTimes.push(t);
  // keep last 6 clicks
  if(clickTimes.length > 6) clickTimes.shift();
  // check last 3 clicks
  if(clickTimes.length >= 3){
    const last3 = clickTimes.slice(-3);
    if((last3[2] - last3[0]) <= 1000) unlock('triple_click');
  }
});

// Refresh detection (on load)
try{
  const nav = performance.getEntriesByType('navigation')[0];
  if(nav && nav.type === 'reload') {
    unlock('refresh_addict');
  } else if (performance.navigation && performance.navigation.type === 1) {
    // older fallback
    unlock('refresh_addict');
  }
} catch(e){ /* ignore */ }

// Touch swipe detection (touchscreen ninja)
let touchStart = null;
document.addEventListener('touchstart', (e)=>{ touchActivity(); resetIdle(); touchStart = e.touches[0] ? {x:e.touches[0].clientX, y:e.touches[0].clientY, t:Date.now()} : null; });
document.addEventListener('touchend', (e)=>{
  touchActivity();
  resetIdle();
  if(!touchStart) return;
  const t = Date.now();
  // no guarantee of touchend coords; quick heuristic using changedTouches if available
  const changed = e.changedTouches && e.changedTouches[0];
  if(changed){
    const dx = changed.clientX - touchStart.x;
    const dy = changed.clientY - touchStart.y;
    const dt = t - touchStart.t;
    const dist = Math.hypot(dx,dy);
    if(dist > 60 && dt < 600) unlock('touchscreen_ninja');
  }
  touchStart = null;
});

// Fullscreen
document.addEventListener('fullscreenchange', ()=>{ if(document.fullscreenElement) unlock('fullscreen_convert'); });

// Copy / Paste events
document.addEventListener('copy', ()=>{ unlock('copycat'); });
document.addEventListener('paste', ()=>{ unlock('forbidden_paste'); });

// Show hidden targets (visual helpers) — toggles a small outline for tiny target & secret area
document.getElementById('showHidden').addEventListener('click', ()=>{
  const tt = document.getElementById('tiny-target');
  const sh = document.getElementById('secret-hover');
  if(tt.style.backgroundColor === 'rgba(255,255,255,0.07)'){
    tt.style.backgroundColor='transparent'; tt.style.border='2px dashed rgba(255,255,255,0.03)';
    sh.style.backgroundColor='transparent';
  } else {
    tt.style.backgroundColor='rgba(255,255,255,0.07)'; tt.style.border='2px solid rgba(255,255,255,0.14)';
    sh.style.backgroundColor='rgba(255,255,255,0.03)';
  }
});

// Reset & Export/Import
document.getElementById('resetBtn').addEventListener('click', ()=>{
  if(!confirm('Reset all achievements?')) return;
  for(const k of Object.keys(state.ach)){ state.ach[k].unlocked = false; state.ach[k].ts = null; }
  state.stats = {};
  persist();
  log('Achievements reset.');
});

document.getElementById('exportBtn').addEventListener('click', ()=>{
  const data = JSON.stringify(state, null, 2);
  const blob = new Blob([data], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url; a.download = 'achievements.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
  log('Exported achievements JSON.');
});

document.getElementById('importBtn').addEventListener('click', async ()=>{
  const input = document.createElement('input'); input.type='file'; input.accept='application/json';
  input.onchange = e => {
    const f = e.target.files[0];
    if(!f) return;
    const reader = new FileReader();
    reader.onload = evt => {
      try{
        const parsed = JSON.parse(evt.target.result);
        if(parsed.ach){
          state = parsed;
          persist();
          log('Imported achievements state.');
          toast('Imported achievements.');
        } else {
          alert('Invalid file: missing achievements structure.');
        }
      }catch(err){ alert('Invalid JSON'); }
    };
    reader.readAsText(f);
  };
  input.click();
});

// Periodic checks & housekeeping
resetIdle();
setInterval(()=>{ checkDevTools(); renderProgress(); persist(); }, 2000);

// final log
log('Ready. Interact with the page to unlock achievements.');

</script>
</body>
</html>
