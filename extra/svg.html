<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Color Image → SVG (HQ)</title>
<style>
  body {
    font-family: system-ui, sans-serif;
    background: #f4f4f4;
    padding: 20px;
  }
  textarea {
    width: 100%;
    height: 320px;
    margin-top: 10px;
    font-family: monospace;
  }
  button {
    padding: 10px 14px;
    margin: 6px 4px 0 0;
    cursor: pointer;
  }
  canvas { display: none; }
</style>
</head>
<body>

<h2>High-Quality Color Image → SVG</h2>
<p>Trace it. Copy it. Clear it. Girl Gang workflow.</p>

<input type="file" id="file" accept="image/*">
<br>

<button onclick="convert()">Convert to SVG</button>
<button onclick="copySVG()">Copy SVG</button>
<button onclick="clearAll()">Clear</button>

<canvas id="canvas"></canvas>

<textarea id="output" placeholder="SVG code appears here..."></textarea>

<script>
function convert() {
  const file = document.getElementById("file").files[0];
  if (!file) return alert("Upload an image first.");

  const img = new Image();
  img.onload = () => {
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    const scale = 300 / img.width;
    canvas.width = 300;
    canvas.height = img.height * scale;
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

    const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;

    const colors = {};
    const step = 32;

    function quant(v) {
      return Math.round(v / step) * step;
    }

    for (let i = 0; i < imgData.length; i += 4) {
      const r = quant(imgData[i]);
      const g = quant(imgData[i+1]);
      const b = quant(imgData[i+2]);
      const key = `${r},${g},${b}`;
      if (!colors[key]) colors[key] = [];
      colors[key].push(i / 4);
    }

    const w = canvas.width;
    let svgPaths = [];

    for (const color in colors) {
      let d = "";
      colors[color].forEach(p => {
        const x = p % w;
        const y = Math.floor(p / w);
        d += `M${x} ${y}h1v1h-1z `;
      });
      svgPaths.push(`<path d="${d}" fill="rgb(${color})"/>`);
    }

    const svg = `
<svg xmlns="http://www.w3.org/2000/svg"
     viewBox="0 0 ${canvas.width} ${canvas.height}">
  ${svgPaths.join("\n  ")}
</svg>`.trim();

    document.getElementById("output").value = svg;
  };

  img.src = URL.createObjectURL(file);
}

function copySVG() {
  const text = document.getElementById("output");
  if (!text.value) return alert("Nothing to copy.");
  text.select();
  text.setSelectionRange(0, 999999);
  navigator.clipboard.writeText(text.value);
  alert("SVG copied ✔");
}

function clearAll() {
  document.getElementById("output").value = "";
  document.getElementById("file").value = "";
}
</script>

</body>
</html>
