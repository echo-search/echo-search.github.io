<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Color Image → SVG (HQ)</title>
<style>
  body {
    font-family: system-ui, sans-serif;
    background: #f4f4f4;
    padding: 20px;
  }
  textarea {
    width: 100%;
    height: 320px;
    margin-top: 10px;
    font-family: monospace;
  }
  button {
    padding: 10px 14px;
    margin-top: 10px;
    cursor: pointer;
  }
  canvas { display: none; }
</style>
</head>
<body>

<h2>High-Quality Color Image → SVG</h2>
<p>Color-aware vector tracing. Clean paths. Girl Gang standards.</p>

<input type="file" id="file" accept="image/*">
<br>
<button onclick="convert()">Convert to SVG</button>

<canvas id="canvas"></canvas>
<textarea id="output" placeholder="SVG code appears here..."></textarea>

<script>
function convert() {
  const file = document.getElementById("file").files[0];
  if (!file) return alert("Upload an image first.");

  const img = new Image();
  img.onload = () => {
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    const scale = 300 / img.width;
    canvas.width = 300;
    canvas.height = img.height * scale;
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

    const imgData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;

    // --- Color Quantization (simple but effective)
    const colors = {};
    const step = 32; // smaller = more colors

    function quant(v) {
      return Math.round(v / step) * step;
    }

    for (let i = 0; i < imgData.length; i += 4) {
      const r = quant(imgData[i]);
      const g = quant(imgData[i+1]);
      const b = quant(imgData[i+2]);
      const key = `${r},${g},${b}`;
      if (!colors[key]) colors[key] = [];
      colors[key].push(i / 4);
    }

    let svgPaths = [];

    const w = canvas.width;

    for (const color in colors) {
      let path = "";
      colors[color].forEach(p => {
        const x = p % w;
        const y = Math.floor(p / w);
        path += `M${x} ${y}h1v1h-1z `;
      });

      svgPaths.push(
        `<path d="${path}" fill="rgb(${color})"/>`
      );
    }

    const svg = `
<svg xmlns="http://www.w3.org/2000/svg"
     viewBox="0 0 ${canvas.width} ${canvas.height}">
  ${svgPaths.join("\n  ")}
</svg>`.trim();

    document.getElementById("output").value = svg;
  };

  img.src = URL.createObjectURL(file);
}
</script>

</body>
</html>
