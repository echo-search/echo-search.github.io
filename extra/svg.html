<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Image → SVG (Live HQ)</title>
<style>
  body {
    font-family: system-ui, sans-serif;
    background: #f4f4f4;
    padding: 20px;
  }
  textarea {
    width: 100%;
    height: 260px;
    margin-top: 10px;
    font-family: monospace;
  }
  button {
    padding: 10px 14px;
    margin: 6px 6px 0 0;
    cursor: pointer;
  }
  canvas { display: none; }
  #preview {
    margin-top: 20px;
    padding: 10px;
    background: white;
    border: 1px solid #ccc;
  }
  #preview svg {
    max-width: 100%;
    height: auto;
    display: block;
  }
</style>
</head>
<body>

<h2>High-Quality Color Image → SVG</h2>
<p>Live preview. Sharp vectors. Girl Gang clarity.</p>

<input type="file" id="file" accept="image/*"><br>

<button onclick="convert()">Convert</button>
<button onclick="copySVG()">Copy SVG</button>
<button onclick="clearAll()">Clear</button>

<canvas id="canvas"></canvas>

<div id="preview"></div>

<textarea id="output" placeholder="SVG code appears here..."></textarea>

<script>
function convert() {
  const file = document.getElementById("file").files[0];
  if (!file) return alert("Upload an image first.");

  const img = new Image();
  img.onload = () => {
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    // HIGH internal resolution = sharp result
    const targetWidth = 800;
    const scale = targetWidth / img.width;
    canvas.width = targetWidth;
    canvas.height = Math.round(img.height * scale);

    ctx.imageSmoothingEnabled = false;
    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

    const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;

    const colors = {};
    const step = 16; // smaller = clearer, more detail

    const quant = v => Math.round(v / step) * step;

    for (let i = 0; i < data.length; i += 4) {
      const r = quant(data[i]);
      const g = quant(data[i + 1]);
      const b = quant(data[i + 2]);
      const a = data[i + 3];
      if (a < 50) continue;

      const key = `${r},${g},${b}`;
      if (!colors[key]) colors[key] = [];
      colors[key].push(i / 4);
    }

    const w = canvas.width;
    let paths = [];

    for (const color in colors) {
      let d = "";
      colors[color].forEach(p => {
        const x = p % w;
        const y = Math.floor(p / w);
        d += `M${x} ${y}h1v1h-1z`;
      });
      paths.push(`<path d="${d}" fill="rgb(${color})"/>`);
    }

    const svg = `
<svg xmlns="http://www.w3.org/2000/svg"
     viewBox="0 0 ${canvas.width} ${canvas.height}"
     shape-rendering="crispEdges">
  ${paths.join("\n  ")}
</svg>`.trim();

    document.getElementById("output").value = svg;
    document.getElementById("preview").innerHTML = svg;
  };

  img.src = URL.createObjectURL(file);
}

function copySVG() {
  const out = document.getElementById("output");
  if (!out.value) return alert("Nothing to copy.");
  navigator.clipboard.writeText(out.value);
  alert("SVG copied ✔");
}

function clearAll() {
  document.getElementById("output").value = "";
  document.getElementById("preview").innerHTML = "";
  document.getElementById("file").value = "";
}
</script>

</body>
</html>
